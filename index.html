<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <title>按鈕與彈窗與像素小人</title>
    <style>
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        font-family: system-ui, sans-serif;
        background-color: #f5f5f5;
        overflow: hidden;
      }

      #openModalBtn {
        padding: 10px 24px;
        border-radius: 4px;
        border: 1px solid #ccc;
        background-color: #ffffff;
        cursor: pointer;
        font-size: 16px;
        z-index: 1;
      }

      .modal-overlay {
        position: fixed;
        inset: 0;
        display: none;
        justify-content: center;
        align-items: center;
        background: rgba(0, 0, 0, 0.45);
        z-index: 500;
      }
      .modal-overlay.show {
        display: flex;
      }

      .modal {
        background: #fff;
        border-radius: 6px;
        max-width: 700px;
        width: 90%;
        max-height: 80vh;
        display: flex;
        flex-direction: column;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
        position: relative;
      }

      .modal-header {
        padding: 16px 20px;
        border-bottom: 1px solid #eee;
        font-size: 18px;
        font-weight: 600;
      }

      .modal-close {
        position: absolute;
        top: 10px;
        right: 14px;
        border: none;
        background: transparent;
        font-size: 20px;
        cursor: pointer;
      }

      .modal-body {
        padding: 16px 20px;
        overflow-y: auto;
        font-size: 14px;
        line-height: 1.6;
        white-space: pre-wrap;
      }

      .modal-footer {
        padding: 12px 20px 16px;
        border-top: 1px solid #eee;
        text-align: right;
        display: flex;
        justify-content: flex-end;
      }

      .start-btn,
      .confirm-btn {
        padding: 6px 16px;
        border-radius: 4px;
        border: none;
        background-color: #007bff;
        color: #fff;
        cursor: pointer;
        font-size: 14px;
      }

      #typeContent {
        font-size: 15px;
        line-height: 1.8;
        white-space: pre-line;
      }

      /* 全白淡入遮罩 */
      #fadeOverlay {
        position: fixed;
        inset: 0;
        background: #ffffff;
        opacity: 0;
        pointer-events: none;
        transition: opacity 1s ease;
        z-index: 900;
      }
      #fadeOverlay.active {
        opacity: 1;
        pointer-events: auto;
      }

      /* 遊戲畫面容器 */
      #gameScreen {
        position: fixed;
        inset: 0;
        background: #000;
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 800;
      }

      #gameCanvas {
        image-rendering: pixelated;
        image-rendering: crisp-edges;
        border: 2px solid #222;
        background: #120c1f;
      }
    </style>
  </head>
  <body>
    <button id="openModalBtn">開啟彈窗</button>

    <!-- 第一彈窗 -->
    <div id="modalOverlay1" class="modal-overlay">
      <div class="modal">
        <div class="modal-header">
          遠離毒品，珍惜自己
          <button class="modal-close" id="closeX1">×</button>
        </div>
        <div class="modal-body">
          我第一次接觸毒品，是在家鄉的稻田裡。平常一起打架的男生遞給我一瓶膠水，說：「吸了這個，會像開飛機一樣快樂。」刺鼻的味道讓我立刻跑開，但那句話卻在我腦裡揮之不去。我渴望快樂。
          回到家，迎接我的永遠是吵架和摔門，沒有人聽我說話。長大後，我越來越討厭上學；沒人關心我，只在乎成績。我越沉默，大人越說我有問題。父母離婚後，我幾乎不再回家。反而是街上的朋友讓我覺得被需要——夜市、吃飯、抽菸、自由，那種被接納的感覺遠勝過家裡一句冷冷的「吃飯了」。
          後來我們玩得更瘋。第一次真正吸毒，是大哥拍著我肩膀說：「一起爽才叫兄弟。」我想被認同，也想證明自己不是多餘的，所以吸了。K、安、冰……一路往下沉。我用忠誠換取了他們的信任。
          直到做生意出事那天，大哥把我推到前面：「弟弟，這次你頂一下，我們會等你出來。」我信了。我替他坐牢，他卻消失。獄中斷癮的痛像活剝，冷汗、嘔吐、抽搐，我恨他們，也恨自己。
          如果可以重新來過，我只想像同齡人一樣，上班、旅遊、談戀愛，而不是在牢房裡熬過每一天。
          毒品不會帶來快樂；需要靠毒品證明的感情，注定不可靠。
          不要吸毒，不要踏進去，一次都不要。
        </div>
        <div class="modal-footer">
          <button class="start-btn" id="startTyping">開始</button>
        </div>
      </div>
    </div>

    <!-- 第二彈窗（打字機效果） -->
    <div id="modalOverlay2" class="modal-overlay">
      <div class="modal">
        <div class="modal-header">
          故事簡介
          <button class="modal-close" id="closeX2">×</button>
        </div>
        <div class="modal-body">
          <div id="typeContent"></div>
        </div>
        <div class="modal-footer">
          <button class="confirm-btn" id="confirm2">確認</button>
        </div>
      </div>
    </div>

    <!-- 全白淡入 -->
    <div id="fadeOverlay"></div>

    <!-- 像素小人遊戲畫面 -->
    <div id="gameScreen">
      <canvas id="gameCanvas" width="800" height="450"></canvas>
    </div>

    <script>
      const openModalBtn = document.getElementById("openModalBtn");
      const modal1 = document.getElementById("modalOverlay1");
      const modal2 = document.getElementById("modalOverlay2");
      const closeX1 = document.getElementById("closeX1");
      const closeX2 = document.getElementById("closeX2");
      const confirm2 = document.getElementById("confirm2");
      const startTypingBtn = document.getElementById("startTyping");
      const typeContent = document.getElementById("typeContent");

      const fadeOverlay = document.getElementById("fadeOverlay");
      const gameScreen = document.getElementById("gameScreen");
      const gameCanvas = document.getElementById("gameCanvas");
      const ctx = gameCanvas.getContext("2d");

      const typingText = [
        "本片以第一人稱視角呈現一名誤入毒品深淵的青年，自述吸毒後身心崩塌的歷程。",
        "畫面以強烈對比與具象化意象，以及生動的旁白，",
        "引導觀眾沉浸於失控的瞬間，",
        "感受悔恨與控訴的真心吶喊。",
      ];

      // 開關彈窗
      openModalBtn.onclick = () => modal1.classList.add("show");
      closeX1.onclick = () => modal1.classList.remove("show");
      closeX2.onclick = () => modal2.classList.remove("show");

      // 打字機效果
      function startTypewriter() {
        typeContent.textContent = "";
        let lineIndex = 0;

        function typeLine() {
          if (lineIndex >= typingText.length) return;
          let line = typingText[lineIndex];
          let charIndex = 0;
          let interval = setInterval(() => {
            typeContent.textContent += line[charIndex];
            charIndex++;
            if (charIndex === line.length) {
              clearInterval(interval);
              typeContent.textContent += "\n";
              lineIndex++;
              setTimeout(typeLine, 400);
            }
          }, 45);
        }
        typeLine();
      }

      startTypingBtn.onclick = () => {
        modal1.classList.remove("show");
        modal2.classList.add("show");
        startTypewriter();
      };

      // 確認後進入全白 → 像素世界
      confirm2.onclick = () => {
        modal2.classList.remove("show");
        fadeOverlay.classList.add("active");

        // 一秒後顯示遊戲畫面
        setTimeout(() => {
          // 隱藏原本按鈕
          openModalBtn.style.display = "none";
          gameScreen.style.display = "flex";
          document.body.style.background = "#000";
          fadeOverlay.classList.remove("active");
          startGame();
        }, 1000);
      };

      // ===== 像素小人遊戲區 =====
      const width = gameCanvas.width;
      const height = gameCanvas.height;

      const groundY = height - 60;

      const player = {
        x: width / 2 - 8,
        y: -30, // 從畫面上方掉落
        w: 18,
        h: 26,
        vy: 0,
        onGround: false,
        speed: 2.5,
      };

      const keys = {
        ArrowLeft: false,
        ArrowRight: false,
        ArrowUp: false,
        ArrowDown: false,
      };

      window.addEventListener("keydown", (e) => {
        if (e.key in keys) {
          keys[e.key] = true;
          e.preventDefault();
        }
      });

      window.addEventListener("keyup", (e) => {
        if (e.key in keys) {
          keys[e.key] = false;
          e.preventDefault();
        }
      });

      function drawBackground() {
        // 暗紫夜空
        ctx.fillStyle = "#120c1f";
        ctx.fillRect(0, 0, width, height);

        // 遠方紫色建築塊
        for (let i = 0; i < width; i += 80) {
          const buildingHeight = 120 + Math.random() * 80;
          ctx.fillStyle = "#3a2458";
          ctx.fillRect(i, height - buildingHeight - 80, 70, buildingHeight);

          // 髒污黃窗
          for (let w = 10; w < 60; w += 20) {
            for (let h2 = 10; h2 < buildingHeight - 20; h2 += 24) {
              if (Math.random() < 0.5) {
                ctx.fillStyle = "#d2b32f";
                ctx.fillRect(i + w, height - buildingHeight - 80 + h2, 8, 10);
              }
            }
          }
        }

        // 近景髒街區
        for (let i = 0; i < width; i += 40) {
          ctx.fillStyle = i % 80 === 0 ? "#5b347a" : "#4a305f";
          ctx.fillRect(i, groundY - 20, 40, 20);

          // 髒污斑點
          ctx.fillStyle = "rgba(20,10,10,0.6)";
          ctx.fillRect(i + Math.random() * 30, groundY - 12, 6, 4);
          ctx.fillRect(i + Math.random() * 30, groundY - 6, 5, 3);
        }

        // 地面
        ctx.fillStyle = "#26212f";
        ctx.fillRect(0, groundY, width, height - groundY);

        // 地面垃圾感
        for (let i = 0; i < 80; i++) {
          ctx.fillStyle = Math.random() < 0.5 ? "#91805b" : "#5a4c38";
          const rx = Math.random() * width;
          const ry = groundY + Math.random() * 30;
          ctx.fillRect(rx, ry, 2 + Math.random() * 3, 2 + Math.random() * 2);
        }
      }

      function drawPlayer() {
        const p = player;

        // 身體（紫色）
        ctx.fillStyle = "#6d3aa8";
        ctx.fillRect(p.x, p.y + 8, p.w, p.h - 8);

        // 頭（膚色）
        ctx.fillStyle = "#f0c7a3";
        ctx.fillRect(p.x + 3, p.y, p.w - 6, 8);

        // 黃色頭髮
        ctx.fillStyle = "#f7d94b";
        ctx.fillRect(p.x + 2, p.y - 2, p.w - 4, 4);

        // 腳（深色）
        ctx.fillStyle = "#1f1b2b";
        ctx.fillRect(p.x + 3, p.y + p.h, 5, 4);
        ctx.fillRect(p.x + p.w - 8, p.y + p.h, 5, 4);

        // 簡單陰影
        ctx.fillStyle = "rgba(0,0,0,0.35)";
        ctx.fillRect(p.x, p.y + p.h + 6, p.w, 3);
      }

      function updatePlayer() {
        const p = player;

        // 掉落
        if (!p.onGround) {
          p.vy += 0.3;
          p.y += p.vy;
          if (p.y + p.h + 4 >= groundY) {
            p.y = groundY - p.h - 4;
            p.vy = 0;
            p.onGround = true;
          }
        } else {
          // 到地面後可用方向鍵微調位置（類似走路）
          if (keys.ArrowLeft) p.x -= p.speed;
          if (keys.ArrowRight) p.x += p.speed;
          if (keys.ArrowUp) p.y -= p.speed * 0.6; // 上下微小飄移，增加不穩定感
          if (keys.ArrowDown) p.y += p.speed * 0.6;

          // 簡單邊界限制
          if (p.x < 10) p.x = 10;
          if (p.x + p.w > width - 10) p.x = width - 10 - p.w;
          if (p.y < groundY - 60) p.y = groundY - 60;
          if (p.y > groundY - p.h - 4) p.y = groundY - p.h - 4;
        }
      }

      let gameRunning = false;

      function gameLoop() {
        if (!gameRunning) return;

        drawBackground();
        updatePlayer();
        drawPlayer();

        requestAnimationFrame(gameLoop);
      }

      function startGame() {
        gameRunning = true;
        // 重設角色狀態
        player.x = width / 2 - 8;
        player.y = -30;
        player.vy = 0;
        player.onGround = false;

        gameLoop();
      }
    </script>
  </body>
</html>
